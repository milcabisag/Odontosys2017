<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="estado_cuenta_paciente" language="groovy" pageWidth="600" pageHeight="500" columnWidth="560" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="8872015c-8cf2-4457-84ea-b70d942f40d3">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<property name="ireport.callouts" value="##Tue Jul 08 13:07:46 PYT 2014"/>
	<subDataset name="New Dataset 1" uuid="e850e6d5-d0fd-449f-acc3-8eaf84d15078">
		<queryString language="SQL">
			<![CDATA[SELECT
     paciente.`idPaciente` AS paciente_idPaciente,
     paciente.`Nombres` AS paciente_Nombres,
     paciente.`Apellidos` AS paciente_Apellidos,
     paciente.`Nro_CI` AS paciente_Nro_CI,
     movimiento.`idmovimiento` AS movimiento_idmovimiento,
     movimiento.`fk_paciente` AS movimiento_fk_paciente,
     movimiento.`fecha` AS movimiento_fecha,
     movimiento.`movimiento` AS movimiento_movimiento,
     movimiento.`debe` AS movimiento_debe,
     movimiento.`haber` AS movimiento_haber,
     datos.`iddatos` AS datos_iddatos,
     datos.`nombre_empresa` AS datos_nombre_empresa,
     datos.`nombre_propietario` AS datos_nombre_propietario,
     datos.`actividad` AS datos_actividad,
     datos.`ruc` AS datos_ruc,
     datos.`direccion` AS datos_direccion,
     datos.`ciudad` AS datos_ciudad,
     datos.`telefono` AS datos_telefono
FROM
     `paciente` paciente INNER JOIN `movimiento` movimiento ON paciente.`idPaciente` = movimiento.`fk_paciente`,
     `datos` datos]]>
		</queryString>
		<field name="paciente_idPaciente" class="java.lang.Integer"/>
		<field name="paciente_Nombres" class="java.lang.String"/>
		<field name="paciente_Apellidos" class="java.lang.String"/>
		<field name="paciente_Nro_CI" class="java.lang.Integer"/>
		<field name="movimiento_idmovimiento" class="java.lang.Integer"/>
		<field name="movimiento_fk_paciente" class="java.lang.Integer"/>
		<field name="movimiento_fecha" class="java.sql.Date"/>
		<field name="movimiento_movimiento" class="java.lang.String"/>
		<field name="movimiento_debe" class="java.lang.Integer"/>
		<field name="movimiento_haber" class="java.lang.Integer"/>
		<field name="datos_iddatos" class="java.lang.Integer"/>
		<field name="datos_nombre_empresa" class="java.lang.String"/>
		<field name="datos_nombre_propietario" class="java.lang.String"/>
		<field name="datos_actividad" class="java.lang.String"/>
		<field name="datos_ruc" class="java.lang.String"/>
		<field name="datos_direccion" class="java.lang.String"/>
		<field name="datos_ciudad" class="java.lang.String"/>
		<field name="datos_telefono" class="java.lang.String"/>
		<group name="paciente_idPaciente">
			<groupExpression><![CDATA[$F{paciente_idPaciente}]]></groupExpression>
		</group>
	</subDataset>
	<parameter name="id_paciente" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT 
     paciente.nombres AS paciente_Nombres,
     paciente.apellidos AS paciente_Apellidos,
     paciente.nro_ci AS paciente_Nro_CI,
     movimiento.fecha AS movimiento_fecha,
     movimiento.movimiento AS movimiento_movimiento,
     movimiento.debe AS movimiento_debe,
     movimiento.haber AS movimiento_haber,
     datos.nombre_empresa AS emp_nom,   
     datos.nombre_propietario AS emp_prop,
     datos.actividad AS emp_actividad,
     datos.direccion AS emp_direccion,
     datos.ciudad AS emp_ciudad,
     datos.telefono AS emp_telefono,
     movimiento.idmovimiento AS idmov
FROM movimiento JOIN datos JOIN paciente
WHERE idmovimiento IN (SELECT fk_movimiento FROM factura WHERE estado = 'Pendiente' AND factura.fk_paciente = $P{id_paciente})
 AND datos.iddatos = 1 AND paciente.idPaciente = $P{id_paciente}
UNION
SELECT 
     paciente.nombres AS paciente_Nombres,
     paciente.apellidos AS paciente_Apellidos,
     paciente.nro_ci AS paciente_Nro_CI,
     movimiento.fecha AS movimiento_fecha,
     movimiento.movimiento AS movimiento_movimiento,
     movimiento.debe AS movimiento_debe,
     movimiento.haber AS movimiento_haber,
     datos.nombre_empresa AS emp_nom,   
     datos.nombre_propietario AS emp_prop,
     datos.actividad AS emp_actividad,
     datos.direccion AS emp_direccion,
     datos.ciudad AS emp_ciudad,
     datos.telefono AS emp_telefono,
     movimiento.idmovimiento AS idmov
FROM movimiento JOIN datos JOIN paciente
WHERE idmovimiento IN (SELECT r.fk_movimiento FROM recibo r JOIN factura ON factura.idfactura = r.fk_factura 
WHERE factura.estado = 'Pendiente' AND factura.fk_paciente = $P{id_paciente}) AND datos.iddatos = 1 AND paciente.idPaciente = $P{id_paciente} 
ORDER BY idmov ASC]]>
	</queryString>
	<field name="paciente_Nombres" class="java.lang.String"/>
	<field name="paciente_Apellidos" class="java.lang.String"/>
	<field name="paciente_Nro_CI" class="java.lang.Integer"/>
	<field name="movimiento_fecha" class="java.sql.Date"/>
	<field name="movimiento_movimiento" class="java.lang.String"/>
	<field name="movimiento_debe" class="java.lang.Integer"/>
	<field name="movimiento_haber" class="java.lang.Integer"/>
	<field name="emp_nom" class="java.lang.String"/>
	<field name="emp_prop" class="java.lang.String"/>
	<field name="emp_actividad" class="java.lang.String"/>
	<field name="emp_direccion" class="java.lang.String"/>
	<field name="emp_ciudad" class="java.lang.String"/>
	<field name="emp_telefono" class="java.lang.String"/>
	<variable name="movimiento_debe_1" class="java.lang.Integer" resetType="Column" calculation="Sum">
		<variableExpression><![CDATA[$F{movimiento_debe}]]></variableExpression>
	</variable>
	<variable name="movimiento_haber_1" class="java.lang.Integer" resetType="Column" calculation="Sum">
		<variableExpression><![CDATA[$F{movimiento_haber}]]></variableExpression>
	</variable>
	<variable name="saldo" class="java.lang.String"/>
	<title>
		<band height="79" splitType="Stretch">
			<rectangle radius="10">
				<reportElement x="0" y="0" width="561" height="45" uuid="ef9bff59-c5ce-408e-baeb-16d2e523b431"/>
			</rectangle>
			<staticText>
				<reportElement x="0" y="46" width="561" height="30" forecolor="#006699" uuid="993a1dd0-a8c5-4658-a73e-418ad0cba4c9"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="20" isBold="true"/>
				</textElement>
				<text><![CDATA[Estado de Cuenta del Paciente]]></text>
			</staticText>
			<textField>
				<reportElement x="260" y="31" width="300" height="14" uuid="d65b4fc0-033d-4afe-85dd-2f325a8cb237"/>
				<textElement textAlignment="Left" markup="none">
					<font size="8" isBold="false" isItalic="false"/>
				</textElement>
				<textFieldExpression><![CDATA["Dirección: "+$F{emp_direccion}+" - "+$F{emp_ciudad}+"  -  Teléfono: "+$F{emp_telefono}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="10" width="250" height="29" uuid="b8b05fa8-108e-4572-99eb-33b471878935"/>
				<textElement textAlignment="Center" markup="none">
					<font size="20" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{emp_nom}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="260" y="17" width="300" height="13" uuid="2c7a281d-7c85-4647-af3a-bd2e06f64932"/>
				<textElement textAlignment="Left" markup="none">
					<font size="10" isBold="false" isItalic="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{emp_actividad}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="260" y="3" width="300" height="13" uuid="8c31702f-574f-45c7-be29-47759995d1cd"/>
				<textElement textAlignment="Left" markup="none">
					<font size="10" isBold="true" isItalic="true"/>
				</textElement>
				<textFieldExpression><![CDATA["De "+$F{emp_prop}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="27" splitType="Stretch">
			<staticText>
				<reportElement mode="Opaque" x="0" y="0" width="76" height="25" forecolor="#006699" backcolor="#EEEDFF" uuid="a904ce2d-c609-43bf-a8d0-12567f3ffd4a"/>
				<box>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[Paciente]]></text>
			</staticText>
			<textField>
				<reportElement x="76" y="0" width="287" height="25" uuid="b1e05f29-85f2-44b1-90d5-7db26c7aeeec"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<paragraph leftIndent="3"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{paciente_Nombres}+" "+$F{paciente_Apellidos}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="363" y="0" width="197" height="25" uuid="0e30efad-b453-47a7-a180-0b5a1ee845fc"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="10"/>
					<paragraph leftIndent="3"/>
				</textElement>
				<textFieldExpression><![CDATA["C.I. Nro: "+$F{paciente_Nro_CI}]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="30" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="100" height="30" backcolor="#E6E6E6" uuid="bdbae0fb-e14f-497b-9792-52b689965ff9"/>
				<box>
					<pen lineWidth="0.5" lineStyle="Solid"/>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<leftPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
					<rightPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[Fecha]]></text>
			</staticText>
			<staticText>
				<reportElement x="100" y="0" width="262" height="30" backcolor="#E6E6E6" uuid="ef772fdc-fb0f-4878-964c-76ce04263ffe"/>
				<box>
					<pen lineWidth="0.5" lineStyle="Solid"/>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<leftPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
					<rightPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[Descripción]]></text>
			</staticText>
			<staticText>
				<reportElement x="362" y="0" width="100" height="30" backcolor="#E6E6E6" uuid="229c7097-56ad-4a46-b4c6-51544a0e8c57"/>
				<box>
					<pen lineWidth="0.5" lineStyle="Solid"/>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<leftPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
					<rightPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[Debe]]></text>
			</staticText>
			<staticText>
				<reportElement x="462" y="0" width="98" height="30" backcolor="#E6E6E6" uuid="5dd82c75-d242-44e9-8407-6f3c933423bb"/>
				<box>
					<pen lineWidth="0.5" lineStyle="Solid"/>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<leftPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
					<rightPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[Haber]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="20">
			<textField pattern="dd/MM/yyyy">
				<reportElement x="0" y="0" width="100" height="20" uuid="d5002173-7ab1-47ab-9d15-e2af2e23b110"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{movimiento_fecha}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="100" y="0" width="262" height="20" uuid="dfbb7090-5bde-490d-a093-756490ec4923"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<paragraph leftIndent="2"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{movimiento_movimiento}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="362" y="0" width="100" height="20" uuid="81785374-38cb-4a99-86b7-301d20e4863c"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{movimiento_debe}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="462" y="0" width="98" height="20" uuid="d0f33e15-4e4f-4b77-8cc4-7643f2b5dd0a"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{movimiento_haber}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="50">
			<staticText>
				<reportElement mode="Opaque" x="0" y="0" width="362" height="25" forecolor="#006699" backcolor="#EEEDFF" uuid="a754c692-01e1-4659-9522-4eb3382a3e33"/>
				<box>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[Totales]]></text>
			</staticText>
			<textField pattern="#,##0">
				<reportElement x="362" y="0" width="100" height="25" uuid="18354589-e118-4a4a-8521-604862cb7761"/>
				<box>
					<pen lineWidth="0.25" lineStyle="Double"/>
					<topPen lineWidth="0.25" lineStyle="Double"/>
					<leftPen lineWidth="0.25" lineStyle="Double"/>
					<bottomPen lineWidth="0.25" lineStyle="Double"/>
					<rightPen lineWidth="0.25" lineStyle="Double"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$V{movimiento_debe_1}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="462" y="0" width="98" height="25" uuid="5257e8fd-5f23-4b9a-9f8f-ae91f9459651"/>
				<box>
					<pen lineWidth="0.25" lineStyle="Double"/>
					<topPen lineWidth="0.25" lineStyle="Double"/>
					<leftPen lineWidth="0.25" lineStyle="Double"/>
					<bottomPen lineWidth="0.25" lineStyle="Double"/>
					<rightPen lineWidth="0.25" lineStyle="Double"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$V{movimiento_haber_1}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement mode="Opaque" x="0" y="24" width="362" height="25" forecolor="#006699" backcolor="#EEEDFF" uuid="9eed7ceb-5e9e-4d5c-ad09-473cba5c4f3e"/>
				<box>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[Saldo]]></text>
			</staticText>
			<textField pattern="#,##0">
				<reportElement x="362" y="24" width="198" height="25" uuid="fb1001d2-81c9-4206-961d-9f3bb84c620d"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$V{movimiento_debe_1}.intValue() - $V{movimiento_haber_1}.intValue()]]></textFieldExpression>
			</textField>
		</band>
	</columnFooter>
</jasperReport>
